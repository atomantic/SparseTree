# Release v0.7.x - AI Discovery Improvements

Released: YYYY-MM-DD

## Overview

This release improves the AI Discovery feature with dismiss functionality, debugging capabilities, and better CLI integration.

## New Features

### AI Discovery Dismiss Functionality (v0.7.0)
- Dismiss AI-discovered candidates to exclude them from future discoveries
- Batch dismiss all unselected candidates at once
- View dismissed candidates with original AI reasoning and tags
- Undo dismiss to restore candidates
- Clear all dismissed candidates for a database
- Dismissed candidates stored in SQLite with `discovery_dismissed` table
- API endpoints: POST `/dismiss`, POST `/dismiss-batch`, GET `/dismissed`, DELETE `/dismissed/:personId`, DELETE `/dismissed`

### AI Discovery Debug Endpoints (v0.7.0)
- New debug endpoints for troubleshooting AI run failures
- GET `/api/ai-discovery/debug/runs` - list recent AI runs with metadata
- GET `/api/ai-discovery/debug/runs/:runId` - detailed run info including prompt preview and output
- Error details capture (last 10 lines of stderr/stdout) stored on failed runs

### Migration Map Visualization (v0.7.x)
- New 6th tree view mode: "Migration Map" plots ancestors on an interactive world map
- Leaflet.js map with OpenStreetMap/CartoDB dark tiles
- Lineage-colored markers (paternal=blue, maternal=red) with generation depth variation
- Migration polylines connecting parent birth to child birth locations
- Time range slider for filtering by birth year
- Paternal/Maternal layer toggle checkboxes
- Geocoding via Nominatim with permanent SQLite cache (`place_geocode` table)
- Progressive geocode broadening: strips specific locality parts to resolve historical place names
- User-initiated batch geocoding with SSE progress streaming (EventSource)
- Sparse tree map page at `/favorites/sparse-tree/:dbId/map`
- API: `GET /api/map/:dbId/:personId`, `GET /api/map/:dbId/sparse`, `GET /api/map/geocode/stream`

## Bug Fixes

### CLI Provider Integration (v0.7.0)
- Fixed large prompt handling via stdin piping for CLI providers (codex, claude-code)
- Added `-` flag detection in provider args to enable stdin mode
- Fixed JSON parsing to find LAST valid JSON array in noisy CLI output
- Handles CLI banners and headers that could interfere with response parsing
- Improved error capture with `errorDetails` field for debugging failures
